<!DOCTYPE html>
<html>
<head>
    <title>DIAGNOSE FETCH - Test File Loading</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>DIAGNOSE FETCH - Testing File Loading</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.textContent = msg;
            output.appendChild(p);
            console.log(`[${type}] ${msg}`);
        }
        
        async function testFetch() {
            log('Testing if fetch works at all...', 'info');
            
            // Test 1: Can we fetch the Python files?
            try {
                log('Test 1: Fetching newton_raphson_clean.py...', 'info');
                const response = await fetch('newton_raphson_clean.py');
                log(`  Status: ${response.status} ${response.statusText}`, 'info');
                log(`  OK: ${response.ok}`, 'info');
                log(`  Type: ${response.type}`, 'info');
                log(`  URL: ${response.url}`, 'info');
                
                if (response.ok) {
                    const text = await response.text();
                    log(`  ✓ Fetched ${text.length} characters`, 'success');
                    
                    // Show first 200 characters
                    log(`  First 200 chars: ${text.substring(0, 200)}...`, 'info');
                    
                    // Check for BOM or encoding issues
                    const firstChar = text.charCodeAt(0);
                    if (firstChar === 0xFEFF) {
                        log('  ⚠ File has BOM (Byte Order Mark)', 'error');
                    }
                    
                    // Check line endings
                    const hasWindows = text.includes('\r\n');
                    const hasUnix = text.includes('\n');
                    log(`  Line endings: Windows(${hasWindows}) Unix(${hasUnix})`, 'info');
                    
                } else {
                    log(`  ✗ Failed to fetch: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`  ✗ Fetch error: ${error.message}`, 'error');
            }
            
            // Test 2: Can we fetch a simple text file?
            try {
                log('\nTest 2: Creating and fetching a test file...', 'info');
                
                // Try to fetch styles.css as a control
                const response = await fetch('styles.css');
                if (response.ok) {
                    const text = await response.text();
                    log(`  ✓ Can fetch styles.css (${text.length} chars)`, 'success');
                } else {
                    log(`  ✗ Cannot fetch styles.css`, 'error');
                }
            } catch (error) {
                log(`  ✗ Error: ${error.message}`, 'error');
            }
            
            // Test 3: Check current location
            log('\nTest 3: Current location info...', 'info');
            log(`  Protocol: ${window.location.protocol}`, 'info');
            log(`  Host: ${window.location.host}`, 'info');
            log(`  Pathname: ${window.location.pathname}`, 'info');
            log(`  Origin: ${window.location.origin}`, 'info');
            
            // Test 4: Try different fetch methods
            log('\nTest 4: Testing different fetch approaches...', 'info');
            
            // Try with explicit path
            try {
                const response = await fetch('./newton_raphson_clean.py');
                log(`  ./newton_raphson_clean.py: ${response.ok ? '✓' : '✗'} (${response.status})`, response.ok ? 'success' : 'error');
            } catch (e) {
                log(`  ./newton_raphson_clean.py: ✗ ${e.message}`, 'error');
            }
            
            // Try with full URL
            try {
                const fullUrl = window.location.origin + window.location.pathname.replace(/[^\/]*$/, '') + 'newton_raphson_clean.py';
                log(`  Trying full URL: ${fullUrl}`, 'info');
                const response = await fetch(fullUrl);
                log(`  Full URL: ${response.ok ? '✓' : '✗'} (${response.status})`, response.ok ? 'success' : 'error');
            } catch (e) {
                log(`  Full URL: ✗ ${e.message}`, 'error');
            }
        }
        
        testFetch();
    </script>
</body>
</html>